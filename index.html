<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Right Spot - Music Player</title>
    <style>
        :root {
            --background: #121212;
            --background-elevated: #1e1e1e;
            --background-highlight: #1a1a1a;
            --text-base: #ffffff;
            --text-subdued: #a7a7a7;
            --accent-base: #1ed760;
            --accent-hover: #1fdf64;
            --decorative-subdued: #292929;
            --essential-negative: #e91429;
            --sidebar-width: 280px;
            --player-height: 90px;
            --top-bar-height: 64px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-base);
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            display: flex;
            height: calc(100% - var(--player-height));
            position: relative;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--background-elevated);
            padding: 24px 12px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 12px;
            font-size: 22px;
            font-weight: 700;
        }

        .logo svg {
            width: 40px;
            height: 40px;
            fill: var(--text-base);
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 12px 16px;
            color: var(--text-subdued);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 700;
        }

        .nav-item.active, .nav-item:hover {
            color: var(--text-base);
            background: var(--background-highlight);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .playlist-list {
            padding: 0 8px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 16px;
            color: var(--text-subdued);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .playlist-item:hover {
            color: var(--text-base);
            background: var(--background-highlight);
        }

        .playlist-count {
            margin-left: auto;
            font-size: 12px;
            color: var(--text-subdued);
        }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: linear-gradient(to bottom, #1a1a1a 0%, var(--background) 40%);
        }

        .top-bar {
            height: var(--top-bar-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-toggle {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: none;
            border: none;
            color: var(--text-subdued);
            cursor: pointer;
        }

        .search-container {
            display: flex;
            align-items: center;
            background: var(--background-elevated);
            border-radius: 500px;
            padding: 8px 16px;
            width: 400px;
            max-width: 100%;
            transition: all 0.2s ease;
        }

        .search-container:focus-within {
            background: var(--background-tinted);
            box-shadow: 0 0 0 2px var(--text-base);
        }

        .search-icon {
            width: 24px;
            height: 24px;
            fill: var(--text-subdued);
            margin-right: 12px;
        }

        .search-input {
            background: none;
            border: none;
            color: var(--text-base);
            outline: none;
            flex: 1;
            font-size: 14px;
        }

        .search-input::placeholder {
            color: var(--text-subdued);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--background-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
        }

        .content-area {
            flex: 1;
            padding: 24px 32px;
            overflow-y: auto;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 24px;
            letter-spacing: -0.04em;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-subtitle {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.04em;
        }

        .see-all-btn {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-subdued);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .see-all-btn:hover {
            color: var(--text-base);
        }

        /* CONTENT GRIDS */
        .content-row {
            margin-bottom: 48px;
        }

        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 48px;
        }

        .quick-access-item {
            display: flex;
            align-items: center;
            background: var(--background-elevated);
            border-radius: 4px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .quick-access-item:hover {
            background: var(--background-highlight);
            transform: translateY(-2px);
        }

        .quick-access-item img {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            margin-right: 16px;
        }

        .quick-access-item span {
            font-size: 16px;
            font-weight: 700;
        }

        .recent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 24px;
        }

        .recent-item {
            background: var(--background-elevated);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recent-item:hover {
            background: var(--background-highlight);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .recent-item-cover {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .recent-item-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recent-item-subtitle {
            font-size: 14px;
            color: var(--text-subdued);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-result-card {
            background: var(--background-elevated);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .track-result-card:hover {
            background: var(--background-highlight);
        }

        .track-result-cover {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .track-result-play-btn {
            position: absolute;
            bottom: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--accent-base);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transform: translateY(8px);
            transition: all 0.2s ease;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .track-result-card:hover .track-result-play-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .track-result-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-result-artist {
            font-size: 14px;
            color: var(--text-subdued);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* BOTTOM PLAYER */
        .bottom-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--player-height);
            background: var(--background-elevated);
            border-top: 1px solid var(--decorative-subdued);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 16px;
            z-index: 1000;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .bottom-player.hidden {
            transform: translateY(100%);
            opacity: 0;
        }

        .now-playing-section {
            display: flex;
            align-items: center;
            gap: 14px;
            width: 30%;
            min-width: 180px;
        }

        .now-playing-cover {
            width: 56px;
            height: 56px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .now-playing-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
            flex: 1;
        }

        .now-playing-title {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .now-playing-artist {
            font-size: 12px;
            color: var(--text-subdued);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .now-playing-actions {
            display: flex;
            gap: 8px;
        }

        .now-playing-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: none;
            border: none;
            color: var(--text-subdued);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .now-playing-btn:hover {
            color: var(--text-base);
        }

        .player-controls-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            max-width: 722px;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: none;
            border: none;
            color: var(--text-subdued);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            color: var(--text-base);
        }

        .play-btn {
            width: 40px;
            height: 40px;
            background: var(--text-base);
            color: var(--background);
        }

        .playback-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .time {
            font-size: 11px;
            color: var(--text-subdued);
            min-width: 40px;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: var(--decorative-subdued);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--text-base);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .player-extras-section {
            display: flex;
            align-items: center;
            gap: 16px;
            width: 30%;
            min-width: 180px;
            justify-content: flex-end;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 120px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: var(--decorative-subdued);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        /* LEGAL MODAL */
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(4px);
        }

        .modal-backdrop.visible {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: var(--background-elevated);
            border-radius: 12px;
            padding: 32px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
            box-shadow: 0 16px 48px rgba(0,0,0,0.5);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.04em;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: none;
            border: none;
            color: var(--text-subdued);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--text-base);
            background: var(--background-highlight);
        }

        .modal-content {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-subdued);
        }

        .modal-content h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-base);
            margin: 20px 0 8px;
        }

        .modal-content p {
            margin-bottom: 12px;
        }

        .modal-content a {
            color: var(--accent-base);
            text-decoration: none;
        }

        .modal-content a:hover {
            text-decoration: underline;
        }

        /* FOOTER */
        .footer {
            margin-top: 80px;
            padding: 40px 0 80px;
            border-top: 1px solid var(--decorative-subdued);
            text-align: center;
            background: linear-gradient(to top, var(--background-press) 0%, transparent 100%);
        }

        .footer-content {
            padding: 0 32px;
        }

        .footer-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--text-subdued);
            text-decoration: none;
        }

        .footer-logo:hover {
            color: var(--text-base);
        }

        .footer-logo svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .footer-copyright {
            font-size: 12px;
            color: var(--text-subdued);
            margin-bottom: 8px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .footer-link {
            font-size: 12px;
            color: var(--text-subdued);
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .footer-link:hover {
            color: var(--text-base);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                z-index: 1001;
                transform: translateX(-100%);
            }

            .sidebar.visible {
                transform: translateX(0);
            }

            .sidebar-backdrop {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
            }

            .sidebar-backdrop.visible {
                display: block;
            }

            .menu-toggle {
                display: flex;
            }

            .recent-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .bottom-player {
                flex-direction: column;
                height: auto;
                padding: 12px;
                gap: 12px;
            }

            .now-playing-section,
            .player-controls-section,
            .player-extras-section {
                width: 100%;
            }

            .now-playing-section {
                justify-content: space-between;
            }

            .volume-control {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .content-area {
                padding: 16px;
            }

            .recent-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .footer-links {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* LOADING */
        .skeleton {
            background: linear-gradient(90deg, var(--background-elevated) 25%, var(--background-highlight) 50%, var(--background-elevated) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Mobile sidebar backdrop -->
    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
    <!-- Legal Modal -->
    <div class="modal-backdrop" id="legalModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Legal Information</h2>
                <button class="modal-close" onclick="closeLegalModal()">‚úï</button>
            </div>
            <div class="modal-content" id="modalContent"></div>
        </div>
    </div>

    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar" role="navigation">
            <div class="logo">Right Spot</div>
            <nav class="nav-menu" role="menubar">
                <a href="#" class="nav-item active" data-page="home" role="menuitem">üè† Home</a>
                <a href="#" class="nav-item" data-page="search" role="menuitem">üîç Search</a>
                <a href="#" class="nav-item" data-page="library" role="menuitem">üìö Your Library</a>
            </nav>
            <div class="playlist-list" id="playlistList">
                <div class="playlist-item" onclick="showLikedSongs()">‚ù§Ô∏è Liked Songs <span class="playlist-count" id="likedCount">0</span></div>
                <div class="playlist-item" onclick="showRecentlyPlayed()">üïê Recently Played</div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="top-bar" role="banner">
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                <div class="search-container" role="search">
                    <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    <input type="text" class="search-input" id="searchInput" placeholder="What do you want to listen to?" autocomplete="off">
                </div>
                <div class="user-avatar" title="User">U</div>
            </header>

            <div class="content-area">
                <!-- HOME PAGE -->
                <div class="page active" id="homePage" role="main">
                    <h1 class="section-title">Good evening</h1>
                    <div class="quick-access-grid">
                        <div class="quick-access-item" onclick="playLikedShuffle()">‚ù§Ô∏è Liked Songs<br><small>Shuffle play</small></div>
                        <div class="quick-access-item" onclick="playRecent()">üïê Recently Played<br><small>Continue listening</small></div>
                        <div class="quick-access-item" onclick="searchGenre('pop')">üî• Popular Hits<br><small>Trending now</small></div>
                        <div class="quick-access-item" onclick="searchGenre('chill')">üåô Chill Vibes<br><small>Relax & focus</small></div>
                    </div>

                    <div class="content-row">
                        <h2 class="section-subtitle">Recently played</h2>
                        <div class="recent-grid" id="recentGrid"></div>
                    </div>

                    <div class="content-row">
                        <h2 class="section-subtitle">Made for you</h2>
                        <div class="recent-grid" id="madeForYouGrid"></div>
                    </div>

                    <div class="content-row">
                        <h2 class="section-subtitle">Popular & Trending</h2>
                        <div class="recent-grid" id="popularGrid"></div>
                    </div>

                    <div class="content-row">
                        <h2 class="section-subtitle">Lofi & Chill</h2>
                        <div class="recent-grid" id="lofiGrid"></div>
                    </div>

                    <!-- FOOTER -->
                    <footer class="footer">
                        <div class="footer-logo">Right Spot</div>
                        <p class="footer-copyright">Copyright 2025-2026 RightSpot LLC - All Rights Reserved</p>
                        <div class="footer-links">
                            <span class="footer-link" onclick="showLegal('terms')">Terms of Service</span>
                            <span class="footer-link" onclick="showLegal('privacy')">Privacy Policy</span>
                            <span class="footer-link" onclick="showLegal('cookies')">Cookie Policy</span>
                            <span class="footer-link" onclick="showLegal('ads')">About Ads</span>
                            <span class="footer-link" onclick="showLegal('legal')">Legal Notice</span>
                        </div>
                    </footer>
                </div>

                <!-- SEARCH PAGE -->
                <div class="page" id="searchPage" role="main">
                    <h1 class="section-title">Search Results</h1>
                    <div class="search-results" id="searchResults"></div>
                </div>

                <!-- LIBRARY PAGE -->
                <div class="page" id="libraryPage" role="main">
                    <h1 class="section-title">Your Library</h1>
                    <div class="library-content">
                        <div class="quick-access-grid" style="margin-bottom: 32px;">
                            <div class="quick-access-item" onclick="showLikedSongs()">‚ù§Ô∏è Liked Songs<br><span id="likedCountLib">0 songs</span></div>
                            <div class="quick-access-item" onclick="showRecentlyPlayed()">üïê Recently Played<br><span id="recentCountLib">0 tracks</span></div>
                        </div>
                        <h2 class="section-subtitle" style="margin-top: 32px;">Your Playlists</h2>
                        <div class="recent-grid" id="userPlaylists"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- BOTTOM PLAYER -->
    <div class="bottom-player hidden" id="bottomPlayer">
        <div class="now-playing-section">
            <img class="now-playing-cover" id="currentArtwork" src="" alt="">
            <div class="now-playing-info">
                <div class="now-playing-title" id="currentTitle">No track playing</div>
                <div class="now-playing-artist" id="currentArtist">-</div>
            </div>
            <div class="now-playing-actions">
                <button class="now-playing-btn" id="likeBtn" onclick="toggleLike()" title="Like">‚ù§Ô∏è</button>
            </div>
        </div>

        <div class="player-controls-section">
            <div class="player-controls">
                <button class="control-btn" id="shuffleBtn" onclick="player.toggleShuffle()" title="Shuffle">üîÄ</button>
                <button class="control-btn" id="prevBtn" onclick="player.playPrevious()">‚èÆÔ∏è</button>
                <button class="control-btn play-btn" id="playPauseBtn" onclick="player.togglePlayPause()">‚ñ∂Ô∏è</button>
                <button class="control-btn" id="nextBtn" onclick="player.playNext()">‚è≠Ô∏è</button>
                <button class="control-btn" id="repeatBtn" onclick="player.toggleRepeat()" title="Repeat">üîÅ</button>
            </div>
            <div class="playback-progress">
                <span class="time" id="currentTime">0:00</span>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="time" id="totalTime">0:30</span>
            </div>
        </div>

        <div class="player-extras-section">
            <div class="volume-control">
                <span>üîä</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
            </div>
        </div>

        <audio id="audioPlayer" preload="none"></audio>
    </div>

    <script>
        // ========================================
        // RIGHT SPOT PLAYER - FULLY FUNCTIONAL
        // ========================================
        class RightSpotPlayer {
            constructor() {
                this.audioPlayer = document.getElementById('audioPlayer');
                this.bottomPlayer = document.getElementById('bottomPlayer');
                this.currentArtwork = document.getElementById('currentArtwork');
                this.currentTitle = document.getElementById('currentTitle');
                this.currentArtist = document.getElementById('currentArtist');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.currentTimeEl = document.getElementById('currentTime');
                this.totalTimeEl = document.getElementById('totalTime');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.searchInput = document.getElementById('searchInput');
                this.searchResults = document.getElementById('searchResults');
                this.likeBtn = document.getElementById('likeBtn');

                this.currentTrack = null;
                this.isPlaying = false;
                this.isShuffled = false;
                this.isRepeating = false;
                this.likedSongs = JSON.parse(localStorage.getItem('likedSongs') || '[]');
                this.recentlyPlayed = JSON.parse(localStorage.getItem('recentlyPlayed') || '[]');
                this.playlists = JSON.parse(localStorage.getItem('playlists') || '[]');

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupMediaSession();
                this.setupProgressBar();
                this.setupVolume();
                this.setupMobileMenu();
                this.loadHomeSections();
                this.updateLibraryStats();
            }

            setupEventListeners() {
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => this.searchTracks(e.target.value), 300);
                });
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchPage(item.dataset.page);
                    });
                });
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                        e.preventDefault();
                        this.togglePlayPause();
                    }
                });
            }

            setupMobileMenu() {
                const menuToggle = document.getElementById('menuToggle');
                const sidebarBackdrop = document.getElementById('sidebarBackdrop');
                menuToggle.addEventListener('click', () => {
                    document.getElementById('sidebar').classList.add('visible');
                    sidebarBackdrop.classList.add('visible');
                });
                sidebarBackdrop.addEventListener('click', () => {
                    document.getElementById('sidebar').classList.remove('visible');
                    sidebarBackdrop.classList.remove('visible');
                });
            }

            setupMediaSession() {
                if (!('mediaSession' in navigator)) return;
                
                navigator.mediaSession.setActionHandler('play', () => this.play());
                navigator.mediaSession.setActionHandler('pause', () => this.pause());
                navigator.mediaSession.setActionHandler('previoustrack', () => this.playPrevious());
                navigator.mediaSession.setActionHandler('nexttrack', () => this.playNext());
            }

            setupProgressBar() {
                this.progressBar.addEventListener('click', (e) => {
                    if (!this.currentTrack || !this.audioPlayer.duration) return;
                    const rect = this.progressBar.getBoundingClientRect();
                    const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                    this.audioPlayer.currentTime = percent * this.audioPlayer.duration;
                    this.updateProgress();
                });
            }

            setupVolume() {
                const savedVolume = localStorage.getItem('volume');
                if (savedVolume !== null) {
                    this.audioPlayer.volume = parseFloat(savedVolume);
                    this.volumeSlider.value = parseFloat(savedVolume) * 100;
                } else {
                    this.audioPlayer.volume = 0.7;
                }
                this.volumeSlider.addEventListener('input', (e) => {
                    const volume = e.target.value / 100;
                    this.audioPlayer.volume = volume;
                    localStorage.setItem('volume', volume);
                });
            }

            async searchTracks(query) {
                if (!query.trim()) {
                    this.searchResults.innerHTML = '';
                    return;
                }

                this.searchResults.innerHTML = '<p style="color: var(--text-subdued); text-align: center; padding: 40px;">Searching...</p>';

                try {
                    // Use a working iTunes API endpoint with proper parameters
                    const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&media=music&entity=song&limit=50`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        this.displaySearchResults(data.results);
                    } else {
                        this.searchResults.innerHTML = '<p style="color: var(--text-subdued); text-align: center; padding: 40px;">No tracks found. Try a different search term.</p>';
                    }
                } catch (error) {
                    console.error('Search error:', error);
                    this.searchResults.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-subdued);">
                            <p style="margin-bottom: 16px;">‚ùå Search failed</p>
                            <p style="font-size: 12px;">${error.message}</p>
                            <p style="font-size: 12px; margin-top: 16px;">Please check your internet connection and try again.</p>
                        </div>
                    `;
                }
            }

            displaySearchResults(tracks) {
                this.searchResults.innerHTML = tracks.map(track => `
                    <div class="track-result-card" onclick="player.playTrack('${track.previewUrl}', '${this.escapeHtml(track.trackName)}', '${this.escapeHtml(track.artistName)}', '${track.artworkUrl600 || track.artworkUrl100 || 'https://via.placeholder.com/300'}')">
                        <img class="track-result-cover" src="${track.artworkUrl100 || 'https://via.placeholder.com/300'}" alt="${this.escapeHtml(track.trackName)}" loading="lazy">
                        <button class="track-result-play-btn">‚ñ∂Ô∏è</button>
                        <h3 class="track-result-title">${this.escapeHtml(track.trackName)}</h3>
                        <p class="track-result-artist">${this.escapeHtml(track.artistName)}</p>
                    </div>
                `).join('');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML.replace(/'/g, "&#39;");
            }

            playTrack(previewUrl, title, artist, artwork) {
                if (!previewUrl) {
                    alert('‚ùå No preview available for this track');
                    return;
                }

                this.currentTrack = { previewUrl, title, artist, artwork };
                
                // Show player
                this.bottomPlayer.classList.remove('hidden');
                
                // Set audio
                this.audioPlayer.src = previewUrl;
                this.audioPlayer.play().then(() => {
                    this.isPlaying = true;
                    this.updatePlayPauseButton();
                    this.updateNowPlaying();
                    this.updateMediaSession();
                    this.addToRecentlyPlayed();
                    this.checkIfLiked();
                }).catch(error => {
                    console.error('Playback error:', error);
                    alert('‚ùå Unable to play this track. It may be restricted.');
                });
            }

            togglePlayPause() {
                if (!this.currentTrack) return;
                
                if (this.isPlaying) {
                    this.audioPlayer.pause();
                    this.isPlaying = false;
                } else {
                    this.audioPlayer.play();
                    this.isPlaying = true;
                }
                this.updatePlayPauseButton();
                this.updateMediaSessionPlaybackState();
            }

            updatePlayPauseButton() {
                this.playPauseBtn.textContent = this.isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
            }

            updateNowPlaying() {
                if (!this.currentTrack) return;
                this.currentArtwork.src = this.currentTrack.artwork || 'https://via.placeholder.com/56';
                this.currentTitle.textContent = this.currentTrack.title;
                this.currentArtist.textContent = this.currentTrack.artist;
            }

            updateProgress() {
                if (!this.currentTrack || !this.audioPlayer.duration) return;
                
                const progress = (this.audioPlayer.currentTime / this.audioPlayer.duration) * 100;
                this.progressFill.style.width = progress + '%';
                this.currentTimeEl.textContent = this.formatTime(this.audioPlayer.currentTime);
                this.totalTimeEl.textContent = this.formatTime(this.audioPlayer.duration);
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            updateMediaSession() {
                if (!('mediaSession' in navigator) || !this.currentTrack) return;
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: this.currentTrack.title,
                    artist: this.currentTrack.artist,
                    album: 'Right Spot',
                    artwork: [{ src: this.currentTrack.artwork, sizes: '512x512', type: 'image/jpeg' }]
                });
                this.updateMediaSessionPlaybackState();
            }

            updateMediaSessionPlaybackState() {
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = this.isPlaying ? 'playing' : 'paused';
                }
            }

            addToRecentlyPlayed() {
                if (!this.currentTrack) return;
                
                // Remove if already exists
                this.recentlyPlayed = this.recentlyPlayed.filter(t => t.title !== this.currentTrack.title);
                // Add to beginning
                this.recentlyPlayed.unshift({...this.currentTrack, timestamp: Date.now()});
                // Keep only last 50
                this.recentlyPlayed = this.recentlyPlayed.slice(0, 50);
                localStorage.setItem('recentlyPlayed', JSON.stringify(this.recentlyPlayed));
                this.updateLibraryStats();
            }

            checkIfLiked() {
                const isLiked = this.likedSongs.some(s => s.title === this.currentTrack.title);
                this.likeBtn.textContent = isLiked ? 'üíö' : 'ü§ç';
            }

            updateLibraryStats() {
                document.getElementById('likedCount').textContent = this.likedSongs.length;
                document.getElementById('likedCountLib').textContent = `${this.likedSongs.length} songs`;
                document.getElementById('recentCountLib').textContent = `${this.recentlyPlayed.length} tracks`;
            }

            switchPage(pageName) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`[data-page="${pageName}"]`).classList.add('active');
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.getElementById(`${pageName}Page`).classList.add('active');
                
                if (pageName === 'home') {
                    this.loadHomeSections();
                } else if (pageName === 'library') {
                    this.showLibraryContent();
                }
            }

            async loadHomeSections() {
                const sections = [
                    { id: 'recentGrid', term: 'pop' },
                    { id: 'madeForYouGrid', term: 'chill' },
                    { id: 'popularGrid', term: 'trending' },
                    { id: 'lofiGrid', term: 'lofi' }
                ];
                
                sections.forEach(section => {
                    this.loadSection(section.id, section.term);
                });
            }

            async loadSection(gridId, term) {
                try {
                    const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&media=music&entity=song&limit=12`);
                    const data = await response.json();
                    const grid = document.getElementById(gridId);
                    grid.innerHTML = data.results.slice(0, 6).map(track => `
                        <div class="recent-item" onclick="player.playTrack('${track.previewUrl}', '${this.escapeHtml(track.trackName)}', '${this.escapeHtml(track.artistName)}', '${track.artworkUrl600 || track.artworkUrl100}')">
                            <img class="recent-item-cover" src="${track.artworkUrl100}" alt="${this.escapeHtml(track.trackName)}" loading="lazy">
                            <h3 class="recent-item-title">${this.escapeHtml(track.trackName)}</h3>
                            <p class="recent-item-subtitle">${this.escapeHtml(track.artistName)}</p>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error(`Error loading ${gridId}:`, error);
                }
            }

            showLibraryContent() {
                // Show liked songs
                const likedContainer = document.getElementById('userPlaylists');
                if (this.likedSongs.length > 0) {
                    likedContainer.innerHTML = this.likedSongs.slice(0, 6).map(song => `
                        <div class="track-result-card" onclick="player.playTrack('${song.previewUrl}', '${this.escapeHtml(song.title)}', '${this.escapeHtml(song.artist)}', '${song.artwork}')">
                            <img class="track-result-cover" src="${song.artwork}" alt="${this.escapeHtml(song.title)}">
                            <button class="track-result-play-btn">‚ñ∂Ô∏è</button>
                            <h3 class="track-result-title">${this.escapeHtml(song.title)}</h3>
                            <p class="track-result-artist">${this.escapeHtml(song.artist)}</p>
                        </div>
                    `).join('');
                } else {
                    likedContainer.innerHTML = '<p style="color: var(--text-subdued); text-align: center; padding: 40px;">No liked songs yet. Like some tracks to see them here!</p>';
                }
            }

            playPrevious() {
                // In a real app, this would play previous in queue
                if (this.recentlyPlayed.length > 1) {
                    const prevTrack = this.recentlyPlayed[1];
                    this.playTrack(prevTrack.previewUrl, prevTrack.title, prevTrack.artist, prevTrack.artwork);
                }
            }

            playNext() {
                // In a real app, this would play next in queue
                if (this.recentlyPlayed.length > 0) {
                    const randomTrack = this.recentlyPlayed[Math.floor(Math.random() * Math.min(10, this.recentlyPlayed.length))];
                    this.playTrack(randomTrack.previewUrl, randomTrack.title, randomTrack.artist, randomTrack.artwork);
                }
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                this.shuffleBtn.style.color = this.isShuffled ? 'var(--accent-base)' : 'var(--text-subdued)';
            }

            toggleRepeat() {
                this.isRepeating = !this.isRepeating;
                this.repeatBtn.style.color = this.isRepeating ? 'var(--accent-base)' : 'var(--text-subdued)';
            }
        }

        // ========================================
        // GLOBAL FUNCTIONS - REAL FEATURES
        // ========================================
        const player = new RightSpotPlayer();

        function toggleLike() {
            if (!player.currentTrack) return;
            
            const index = player.likedSongs.findIndex(s => s.title === player.currentTrack.title);
            if (index === -1) {
                player.likedSongs.push({...player.currentTrack});
                player.likeBtn.textContent = 'üíö';
            } else {
                player.likedSongs.splice(index, 1);
                player.likeBtn.textContent = 'ü§ç';
            }
            localStorage.setItem('likedSongs', JSON.stringify(player.likedSongs));
            player.updateLibraryStats();
        }

        function playLikedShuffle() {
            if (player.likedSongs.length === 0) {
                alert('No liked songs yet! Like some tracks first.');
                return;
            }
            const randomSong = player.likedSongs[Math.floor(Math.random() * player.likedSongs.length)];
            player.playTrack(randomSong.previewUrl, randomSong.title, randomSong.artist, randomSong.artwork);
        }

        function playRecent() {
            if (player.recentlyPlayed.length === 0) {
                alert('No recently played tracks yet!');
                return;
            }
            const lastPlayed = player.recentlyPlayed[0];
            player.playTrack(lastPlayed.previewUrl, lastPlayed.title, lastPlayed.artist, lastPlayed.artwork);
        }

        function searchGenre(genre) {
            player.switchPage('search');
            player.searchInput.value = genre;
            player.searchTracks(genre);
        }

        function showLikedSongs() {
            player.switchPage('library');
            player.showLibraryContent();
        }

        function showRecentlyPlayed() {
            if (player.recentlyPlayed.length === 0) {
                alert('No recently played tracks yet!');
                return;
            }
            player.switchPage('search');
            player.searchResults.innerHTML = player.recentlyPlayed.slice(0, 20).map(track => `
                <div class="track-result-card" onclick="player.playTrack('${track.previewUrl}', '${player.escapeHtml(track.title)}', '${player.escapeHtml(track.artist)}', '${track.artwork}')">
                    <img class="track-result-cover" src="${track.artwork}" alt="${player.escapeHtml(track.title)}">
                    <button class="track-result-play-btn">‚ñ∂Ô∏è</button>
                    <h3 class="track-result-title">${player.escapeHtml(track.title)}</h3>
                    <p class="track-result-artist">${player.escapeHtml(track.artist)}</p>
                </div>
            `).join('');
        }

        function showLegal(type) {
            const content = {
                terms: `
                    <h3>Terms of Service</h3>
                    <p>Last updated: January 1, 2025</p>
                    <p>By accessing or using Right Spot, you agree to be bound by these Terms. Right Spot is a music player application that uses the Apple iTunes Search API to provide 30-second song previews.</p>
                    <h3>1. Use License</h3>
                    <p>Permission is granted to use Right Spot for personal, non-commercial purposes only. This is a demonstration application for educational purposes.</p>
                    <h3>2. Content</h3>
                    <p>All music content is provided by Apple iTunes API and is subject to Apple's terms. We do not host any audio files.</p>
                    <h3>3. User Data</h3>
                    <p>Your data (liked songs, recently played) is stored locally in your browser and is not transmitted to any servers.</p>
                    <h3>4. Limitations</h3>
                    <p>Track previews are limited to 30 seconds as provided by iTunes. Full songs are not available.</p>
                `,
                privacy: `
                    <h3>Privacy Policy</h3>
                    <p>Last updated: January 1, 2025</p>
                    <h3>1. Data Collection</h3>
                    <p>Right Spot does not collect, store, or transmit any personal data. All information (liked songs, recently played) is stored locally in your browser.</p>
                    <h3>2. Third-Party Services</h3>
                    <p>We use the Apple iTunes Search API to fetch music metadata and previews. Your search queries are sent to Apple's servers.</p>
                    <h3>3. Cookies</h3>
                    <p>Right Spot does not use cookies. We use localStorage to save your preferences and library data on your device.</p>
                    <h3>4. Data Security</h3>
                    <p>Since no data leaves your device, your privacy is completely protected. Clear your browser data to remove all information.</p>
                `,
                cookies: `
                    <h3>Cookie Policy</h3>
                    <p>Last updated: January 1, 2025</p>
                    <h3>No Cookies Used</h3>
                    <p>Right Spot does not use cookies or similar tracking technologies.</p>
                    <h3>Local Storage</h3>
                    <p>We use your browser's localStorage to save:</p>
                    <ul style="margin-left: 20px; color: var(--text-subdued);">
                        <li>Liked songs</li>
                        <li>Recently played tracks</li>
                        <li>Volume preferences</li>
                    </ul>
                    <p>This data never leaves your device and can be cleared by clearing your browser data.</p>
                `,
                ads: `
                    <h3>About Ads</h3>
                    <p>Last updated: January 1, 2025</p>
                    <h3>No Advertising</h3>
                    <p>Right Spot contains no advertisements. This is a free, open-source demonstration application.</p>
                    <h3>Non-Commercial Use</h3>
                    <p>This app is built for educational and demonstration purposes only and does not generate revenue.</p>
                `,
                legal: `
                    <h3>Legal Notice</h3>
                    <p>Last updated: January 1, 2025</p>
                    <h3>Copyright</h3>
                    <p>Right Spot is an independent project and is not affiliated with Spotify or Apple. All trademarks belong to their respective owners.</p>
                    <h3>Music Content</h3>
                    <p>Audio previews are provided by Apple iTunes Search API and remain the property of their respective copyright holders.</p>
                    <h3>Contact</h3>
                    <p>For questions about this application, please refer to the source code and documentation.</p>
                `
            };

            document.getElementById('modalTitle').textContent = type.charAt(0).toUpperCase() + type.slice(1).replace(/([A-Z])/g, ' $1');
            document.getElementById('modalContent').innerHTML = content[type];
            document.getElementById('legalModal').classList.add('visible');
        }

        function closeLegalModal() {
            document.getElementById('legalModal').classList.remove('visible');
        }

        // Load initial sections
        player.loadHomeSections();
    </script>
</body>
</html>

